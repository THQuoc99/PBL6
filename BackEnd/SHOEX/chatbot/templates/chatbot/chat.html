<!DOCTYPE html>

<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ChatGPT Web Demo</title>
  <style>
    body { font-family: sans-serif; background: #f2f2f2; }
    .chat-box { width: 600px; margin: 40px auto; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 0 10px #ccc; }
    .messages { height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; }
    .user { color: blue; margin-bottom: 8px; }
    .bot { color: green; margin-bottom: 8px; }
    input { width: 80%; padding: 10px; }
    button { padding: 10px; }
  </style>
</head>
<body>
  <div class="chat-box">
    <h3>ðŸ’¬ Chat bot</h3>
    <div id="chat" class="messages"></div>
    <input id="message" type="text" placeholder="Nháº­p tin nháº¯n..." />
    <button onclick="sendMessage()">Gá»­i</button>
  </div>

  <script>
    async function sendMessage() {
      const msg = document.getElementById("message").value.trim();
      if (!msg) return;

      const chat = document.getElementById("chat");
      chat.innerHTML += `<div class="user"><b>Báº¡n:</b> ${msg}</div>`;
      document.getElementById("message").value = "";

      // Hiá»ƒn thá»‹ tráº¡ng thÃ¡i Ä‘ang soáº¡n
      chat.innerHTML += `<div id="loading" class="bot"><i></i></div>`;
      chat.scrollTop = chat.scrollHeight;

      try {
        const response = await fetch("/chatbot/chat/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: msg })
        });

        const data = await response.json();
        document.getElementById("loading")?.remove();

        if (data.response) {
          chat.innerHTML += `<div class="bot"><b>Chatbot:</b> ${data.response}</div>`;
        } else if (data.error) {
          chat.innerHTML += `<div class="bot"><b>Lá»—i:</b> ${data.error}</div>`;
        } else {
          chat.innerHTML += `<div class="bot"><b>Lá»—i:</b> KhÃ´ng cÃ³ pháº£n há»“i tá»« server</div>`;
        }

        chat.scrollTop = chat.scrollHeight;
      } catch (err) {
        document.getElementById("loading")?.remove();
        chat.innerHTML += `<div class="bot"><b>Lá»—i:</b> ${err.message}</div>`;
      }
    }
  </script>

</body>
</html>
